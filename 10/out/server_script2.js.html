<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: server_script2.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: server_script2.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const http = require("http");
const fs = require("fs");
const url = require("url");
const querystring = require("querystring");

const guestBookFile = "guestbook.txt";

/**
 * Odczytuje zawartość księgi gości z pliku.
 * @param {function} callback - Funkcja zwrotna wywoływana po odczytaniu danych.
 */
function readGuestBook(callback) {
  fs.readFile(guestBookFile, "utf8", (err, data) => {
    if (err) {
      callback(err, null);
    } else {
      const entries = data.split("\n").filter((entry) => entry.trim() !== "");
      callback(null, entries);
    }
  });
}

/**
 * Dodaje nowy wpis do księgi gości.
 * @param {string} newEntry - Nowy wpis do dodania.
 * @param {function} callback - Funkcja zwrotna wywoływana po dodaniu wpisu.
 */
function appendToGuestBook(newEntry, callback) {
  fs.appendFile(guestBookFile, newEntry, (err) => {
    if (err) {
      callback(err);
    } else {
      callback(null);
    }
  });
}

/**
 * Obsługuje żądania HTTP.
 * @param {http.IncomingMessage} req - Obiekt reprezentujący przychodzące żądanie.
 * @param {http.ServerResponse} res - Obiekt reprezentujący odpowiedź serwera.
 */
function handleRequest(req, res) {
  const parsedUrl = url.parse(req.url);
  const pathName = parsedUrl.pathname;

  if (req.method === "GET" &amp;&amp; pathName === "/") {
    readGuestBook((err, entries) => {
      if (err) {
        res.writeHead(500, { "Content-Type": "text/html; charset=utf-8" });
        res.end("Błąd odczytu księgi gości");
      } else {
        let guestBookContent =
          '&lt;head>&lt;meta charset="utf-8">&lt;title>Księga gości&lt;/title>&lt;/head>&lt;body>&lt;h1>Poprzednie wpisy&lt;/h1>';
        entries.forEach((entry) => {
          guestBookContent += `&lt;p>${entry}&lt;/p>`;
        });
        guestBookContent += `
          &lt;h2>Nowy wpis:&lt;/h2>
          &lt;form action="/" method="post">
              &lt;label>Twoje imię i nazwisko:&lt;/label>&lt;br>
              &lt;input type="text" name="name">&lt;br>
              &lt;label>Treść wpisu:&lt;/label>&lt;br>
              &lt;textarea name="message" rows="4" cols="50">&lt;/textarea>&lt;br>
              &lt;input type="submit" value="Dodaj wpis">
          &lt;/form>
        `;
        res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
        res.end(guestBookContent);
      }
    });
  } else if (req.method === "POST" &amp;&amp; pathName === "/") {
    let body = "";
    req.on("data", (chunk) => {
      body += chunk.toString();
    });
    req.on("end", () => {
      const parsedBody = querystring.parse(body);
      const name = parsedBody.name || "Anonymous";
      const message = parsedBody.message || "";
      const newEntry = `${name}\n${message}\n`;

      appendToGuestBook(newEntry, (err) => {
        if (err) {
          res.writeHead(500, { "Content-Type": "text/html; charset=utf-8" });
          res.end("Błąd dodawania wpisu");
        } else {
          res.writeHead(302, { Location: "/" });
          res.end();
        }
      });
    });
  } else {
    res.writeHead(404, { "Content-Type": "text/html; charset=utf-8" });
    res.end("Strona nie istnieje");
  }
}

const server = http.createServer(handleRequest);

const PORT = 8000;
server.listen(PORT, () => {
  console.log(`Serwer uruchomiony na porcie ${PORT}`);
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#appendToGuestBook">appendToGuestBook</a></li><li><a href="global.html#handleRequest">handleRequest</a></li><li><a href="global.html#readGuestBook">readGuestBook</a></li><li><a href="global.html#requestListener">requestListener</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Tue Dec 19 2023 18:49:49 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
